---
title: GO Analysis Combined (n=3)
author: Justin M. Fear
date: 'Compiled: `r format(Sys.Date(), "%B %d, %Y")`'
output: 
    html_document:
        self_contained: TRUE
        keep_md: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    warning = FALSE,
    message = FALSE,
    include = TRUE,
    echo = FALSE,
    cache.lazy = FALSE,
    fig.path = "combined_n3_GO_figures/",
    fig.ext = c("png", "svg"),
    fig.width = 8
)
```
```{r globals}
PROJ_DIR = '/home/fearjm/Projects/larval_gonad'
```

```{r load_library}
library(feather)
library(dplyr)
library(clusterProfiler)
```

```{r helper_function}
gogo <- function(clus, df, bg) {
    genes <- df %>%
        filter(cluster == clus) %>%
        dplyr::select(FBgn) %>%
        pull(.)

    res <- enrichGO(
        genes,
        OrgDb = "org.Dm.eg.db",
        keyType = "FLYBASE",
        ont = "BP",
        universe = bg,
        pAdjustMethod = "BH",
        qvalueCutoff = .01
    )

    return(res)
}
```

```{r load_biomarkers}
biomarkers <- read_feather("combined_n3_biomarkers.feather") %>% filter(p_val_adj <= 0.001)
```

```{r background}
background <- read_feather("combined_n3_normalized.feather") %>% pull(FBgn)
```

```{r lit_genes, echo=TRUE}
lit_genes <- yaml::yaml.load_file(file.path(PROJ_DIR, "config/literature_genes.yaml"))
```

## Spermatogonia (SP)

### Biolgoical Process
```{r sp, fig.width=10, fig.height=10}
res <- gogo("9", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_sp, echo=TRUE}
gl <- lit_genes[["gonia"]]
print(sum(gl %in% res@gene) / length(gl))
```

## Early Primary Spermatocytes (EPS)

### Biolgoical Process
```{r eps, fig.width=10, fig.height=10}
res <- gogo("5", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_eps, echo=TRUE}
gl <- lit_genes[["spermatocytes"]]
print(sum(gl %in% res@gene) / length(gl))
```

## Primary Spermatocytes (PS)

### Biolgoical Process (PS1)
```{r ps1, fig.width=10, fig.height=10}
res <- gogo("6", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_ps1, echo=TRUE}
gl <- lit_genes[['spermatocytes']]
print(sum(gl %in% res@gene) / length(gl))
```

### Biolgoical Process (PS2)
```{r ps2, fig.width=10, fig.height=10}
res <- gogo("2", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_ps2, echo=TRUE}
gl <- lit_genes[['spermatocytes']]
print(sum(gl %in% res@gene) / length(gl))
```

### Biolgoical Process (PS3)
```{r ps3, fig.width=10, fig.height=10}
res <- gogo("0", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_ps3, echo=TRUE}
gl <- lit_genes[['spermatocytes']]
print(sum(gl %in% res@gene) / length(gl))
```

## Early Cyst Cells (ECY)

### Biolgoical Process
```{r ecy, fig.width=10, fig.height=10}
res <- gogo("4", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_ecy, echo=TRUE}
gl <- lit_genes[['cysc']]
print(sum(gl %in% res@gene) / length(gl))
```

## Cyst Cells (CY)

### Biolgoical Process (CY1)
```{r cy1, fig.width=10, fig.height=10}
res <- gogo("1", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_cy1, echo=TRUE}
gl <- lit_genes[['cysc']]
print(sum(gl %in% res@gene) / length(gl))
```

### Biolgoical Process (CY2)
```{r cy2, fig.width=10, fig.height=10}
res <- gogo("3", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_cy2, echo=TRUE}
gl <- lit_genes[['cysc']]
print(sum(gl %in% res@gene) / length(gl))
```

## Terminal Epithelium (TE)

### Biolgoical Process
```{r te, fig.width=10, fig.height=10}
res <- gogo("7", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_te, echo=TRUE}
gl <- lit_genes[['te']]
print(sum(gl %in% res@gene) / length(gl))
```

## Pigment Cells (PC)

### Biolgoical Process
```{r pc, fig.width=10, fig.height=10}
res <- gogo("8", biomarkers, background)
dotplot(res, showCategory = 20)
```

```{r pct_lit_pc, echo=TRUE}
gl <- lit_genes[['pigment']]
print(sum(gl %in% res@gene) / length(gl))
```
